#!/usr/bin/env cwl-runner

description: |
    Usage: cwl-runner <path_to_cwl_file> options
    Options:
        --ref           path to reference genome
        --normal        path to normal bam file
        --tumor         path to tumor bam file
        --snp           path to output snp file
        --normal_id     universal identifier for normal dataset
        --tumor_id      universal identifier for tumor dataset
        --case_id       unique identifier for the patient
        --outdir        path to output directory
        --username      username for postgres database
        --password      password for postgres database

requirements:
  - import: node-engine.cwl
  - class: DockerRequirement
    dockerPull: quay.io/ncigdc/somaticsniper-tool:latest

class: CommandLineTool

inputs:
  - id: "#ref"
    type: File
    inputBinding:
        prefix: --ref
        secondaryFiles:
          - ".fai"

  - id: "#normal"
    type: File
    inputBinding:
        prefix: --normal
            
  - id: "#tumor"
    type: File
    inputBinding:
        prefix: --tumor

  - id: "#snp"
    type: string
    inputBinding:
        prefix: --snp

  - id: "#username"
    type: string
    inputBinding:
        prefix: --username

  - id: "#password"
    type: string
    inputBinding:
        prefix: --password

  - id: "#normal_id"
    type: string
    default: "unknown"
    inputBinding:
        prefix: --normal_id

  - id: "#tumor_id"
    type: string
    default: "unknown"
    inputBinding:
        prefix: --tumor_id

  - id: "#case_id"
    type: string
    default: "unknown"
    inputBinding:
        prefix: --case_id

  - id: "#outdir"
    type: string
    default: "./"
    inputBinding:
        prefix: --outdir

outputs:
  - id: "#snp_out"
    type: File
    description: "snp file"
    outputBinding: 
        glob:
            engine: node-engine.cwl
            script: |
                {
                return $job['snp']
                }

  - id: "#log"
    type: File
    description: "python log file"
    outputBinding: 
        glob:
            engine: node-engine.cwl
            script: |
                {
                return $job['case_id']+".somaticsniper.log"
                }

baseCommand: ["/home/ubuntu/.virtualenvs/p3/bin/python","/home/ubuntu/bin/somaticsniper-tool/somaticsniper-main.py"]


